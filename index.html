import React, { useState, useMemo } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar, Cell } from 'recharts';

const BinuangeunMaritimeViz = () => {
  const [activeViz, setActiveViz] = useState('seasonal');
  const [selectedParam, setSelectedParam] = useState('SHC');

  const realData = {
    seasonal: {
      SHC: {1: 1.72, 2: 1.73, 3: 1.70, 4: 1.79, 5: 2.06, 6: 2.27, 7: 2.44, 8: 2.45, 9: 2.32, 10: 2.03, 11: 1.75, 12: 1.66},
      MWP: {1: 9.26, 2: 9.34, 3: 9.93, 4: 10.30, 5: 10.19, 6: 10.30, 7: 9.97, 8: 9.71, 9: 9.63, 10: 9.49, 11: 9.29, 12: 9.39},
      SSRD: {1: 70.13, 2: 71.59, 3: 75.58, 4: 73.38, 5: 70.97, 6: 67.05, 7: 70.86, 8: 79.94, 9: 85.55, 10: 85.11, 11: 75.56, 12: 72.25},
      TP: {1: 0.52, 2: 0.51, 3: 0.39, 4: 0.32, 5: 0.22, 6: 0.19, 7: 0.14, 8: 0.07, 9: 0.10, 10: 0.19, 11: 0.38, 12: 0.45},
      T2M: {1: 26.45, 2: 26.57, 3: 26.87, 4: 27.14, 5: 27.36, 6: 26.95, 7: 26.24, 8: 25.76, 9: 25.63, 10: 26.09, 11: 26.44, 12: 26.50},
      WIND: {1: 3.40, 2: 3.64, 3: 1.31, 4: 1.86, 5: 4.83, 6: 5.43, 7: 6.99, 8: 7.83, 9: 7.52, 10: 6.25, 11: 3.84, 12: 1.42}
    }
  };

  const parameters = {
    SHC: { name: 'Tinggi Gelombang (m)', color: '#2563eb', unit: 'm' },
    MWP: { name: 'Periode Gelombang (s)', color: '#7c3aed', unit: 's' },
    SSRD: { name: 'Radiasi Solar (W/m¬≤)', color: '#f59e0b', unit: 'W/m¬≤' },
    TP: { name: 'Presipitasi (mm)', color: '#06b6d4', unit: 'mm' },
    WIND: { name: 'Kecepatan Angin (m/s)', color: '#10b981', unit: 'm/s' },
    T2M: { name: 'Suhu 2m (¬∞C)', color: '#ef4444', unit: '¬∞C' }
  };

  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];

  const seasonalData = useMemo(() => {
    return months.map((month, idx) => ({
      month,
      SHC: realData.seasonal.SHC[idx + 1],
      MWP: realData.seasonal.MWP[idx + 1],
      SSRD: realData.seasonal.SSRD[idx + 1],
      TP: realData.seasonal.TP[idx + 1],
      WIND: realData.seasonal.WIND[idx + 1],
      T2M: realData.seasonal.T2M[idx + 1]
    }));
  }, []);

  const saltPotentialData = useMemo(() => {
    return months.map((month, idx) => {
      const solar = realData.seasonal.SSRD[idx + 1];
      const precip = realData.seasonal.TP[idx + 1];
      const temp = realData.seasonal.T2M[idx + 1];
      const wind = realData.seasonal.WIND[idx + 1];
      
      const solarScore = (solar / 96) * 100;
      const precipScore = (1 - (precip / 0.53)) * 100;
      const tempScore = ((temp - 25) / 2.5) * 100;
      const windScore = (wind / 8) * 40;
      
      const potential = (solarScore * 0.4 + precipScore * 0.35 + tempScore * 0.15 + windScore * 0.1);
      
      return {
        month,
        potential: Math.max(0, Math.min(100, potential)),
        solar,
        precip,
        temp,
        wind
      };
    });
  }, []);

  const getOptimalPeriods = () => {
    const scores = seasonalData.map((d, idx) => ({
      month: d.month,
      dryingScore: (d.SSRD / 85) * 100 - (d.TP / 0.5) * 100 + ((2.5 - d.SHC) / 2.5) * 50,
      safetyScore: ((2.5 - d.SHC) / 2.5) * 100 + ((8 - d.WIND) / 8) * 50,
      maintenanceScore: d.SHC,
      saltScore: saltPotentialData[idx].potential
    }));
    
    const drying = [...scores].sort((a, b) => b.dryingScore - a.dryingScore).slice(0, 3).map(d => d.month);
    const safest = [...scores].sort((a, b) => b.safetyScore - a.safetyScore).slice(0, 3).map(d => d.month);
    const maintenance = [...scores].sort((a, b) => b.maintenanceScore - a.maintenanceScore).slice(0, 2).map(d => d.month);
    const saltProduction = [...scores].sort((a, b) => b.saltScore - a.saltScore).slice(0, 3).map(d => d.month);
    
    return { drying, safest, maintenance, saltProduction };
  };

  const optimalPeriods = getOptimalPeriods();

  return (
    <div className="w-full min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-6">
      <div className="max-w-7xl mx-auto">
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h1 className="text-3xl font-bold text-gray-800 mb-2">
            üåä Analisis Iklim Maritim Binuangeun
          </h1>
          <p className="text-gray-600">
            Data ERA5 (1980-2024, 45 tahun) ‚Ä¢ Resolusi 3-jam ‚Ä¢ 6.8¬∞S-8.8¬∞S, 104.6¬∞E-106.6¬∞E
          </p>
        </div>

        <div className="flex gap-4 mb-6">
          <button
            onClick={() => setActiveViz('seasonal')}
            className={`flex-1 py-3 px-6 rounded-lg font-semibold ${
              activeViz === 'seasonal' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'
            }`}
          >
            üìä Siklus Bulanan
          </button>
          <button
            onClick={() => setActiveViz('salt')}
            className={`flex-1 py-3 px-6 rounded-lg font-semibold ${
              activeViz === 'salt' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'
            }`}
          >
            üßÇ Potensi Garam
          </button>
        </div>

        {activeViz === 'seasonal' && (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg p-5 text-white">
                <div className="text-sm font-semibold mb-2">‚òÄÔ∏è OPTIMAL PENGERINGAN IKAN</div>
                <div className="text-2xl font-bold mb-2">{optimalPeriods.drying.join(', ')}</div>
                <div className="text-xs opacity-90">Solar tinggi, hujan minimal</div>
              </div>
              <div className="bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg p-5 text-white">
                <div className="text-sm font-semibold mb-2">‚öì BULAN PALING AMAN</div>
                <div className="text-2xl font-bold mb-2">{optimalPeriods.safest.join(', ')}</div>
                <div className="text-xs opacity-90">Gelombang rendah</div>
              </div>
              <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-lg p-5 text-white">
                <div className="text-sm font-semibold mb-2">üîß MAINTENANCE</div>
                <div className="text-2xl font-bold mb-2">{optimalPeriods.maintenance.join(', ')}</div>
                <div className="text-xs opacity-90">Gelombang tinggi</div>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {Object.entries(parameters).map(([key, param]) => (
                <div key={key} className="bg-white rounded-lg shadow-lg p-5">
                  <h3 className="text-lg font-bold text-gray-800 mb-4">{param.name}</h3>
                  <ResponsiveContainer width="100%" height={250}>
                    <LineChart data={seasonalData}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="month" tick={{ fontSize: 12 }} />
                      <YAxis tick={{ fontSize: 12 }} />
                      <Tooltip />
                      <Line type="monotone" dataKey={key} stroke={param.color} strokeWidth={3} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              ))}
            </div>
          </div>
        )}

        {activeViz === 'salt' && (
          <div className="space-y-6">
            <div className="bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg p-6 text-white">
              <div className="text-sm font-semibold mb-2">üßÇ BULAN OPTIMAL PRODUKSI GARAM</div>
              <div className="text-3xl font-bold mb-2">{optimalPeriods.saltProduction.join(', ')}</div>
              <div className="text-sm opacity-90">Solar tinggi, presipitasi rendah, suhu optimal</div>
            </div>

            <div className="bg-white rounded-lg shadow-lg p-6">
              <h3 className="text-xl font-bold text-gray-800 mb-4">Indeks Potensi Produksi Garam (0-100)</h3>
              <ResponsiveContainer width="100%" height={350}>
                <BarChart data={saltPotentialData}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="month" tick={{ fontSize: 12 }} />
                  <YAxis tick={{ fontSize: 12 }} />
                  <Tooltip />
                  <Bar dataKey="potential" radius={[8, 8, 0, 0]}>
                    {saltPotentialData.map((entry, index) => (
                      <Cell key={index} fill={entry.potential > 70 ? '#10b981' : entry.potential > 50 ? '#fbbf24' : '#ef4444'} />
                    ))}
                  </Bar>
                </BarChart>
              </ResponsiveContainer>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="bg-white rounded-lg shadow-lg p-6">
                <h3 className="text-lg font-bold mb-4">üí° Metodologi Perhitungan</h3>
                <div className="space-y-3 text-sm">
                  <div className="flex gap-3">
                    <div className="bg-yellow-100 rounded-full w-8 h-8 flex items-center justify-center font-bold">40%</div>
                    <div>
                      <div className="font-semibold">Radiasi Solar</div>
                      <div className="text-gray-600">Evaporasi air laut</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <div className="bg-blue-100 rounded-full w-8 h-8 flex items-center justify-center font-bold">35%</div>
                    <div>
                      <div className="font-semibold">Presipitasi</div>
                      <div className="text-gray-600">Hujan rendah optimal</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <div className="bg-red-100 rounded-full w-8 h-8 flex items-center justify-center font-bold">15%</div>
                    <div>
                      <div className="font-semibold">Suhu Udara</div>
                      <div className="text-gray-600">Evaporasi cepat</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <div className="bg-green-100 rounded-full w-8 h-8 flex items-center justify-center font-bold">10%</div>
                    <div>
                      <div className="font-semibold">Kecepatan Angin</div>
                      <div className="text-gray-600">Bantu penguapan</div>
                    </div>
                  </div>
                </div>
              </div>

              <div className="bg-white rounded-lg shadow-lg p-6">
                <h3 className="text-lg font-bold mb-4">üìà Interpretasi Indeks</h3>
                <div className="space-y-3">
                  <div className="flex gap-3">
                    <div className="w-12 h-12 rounded-lg bg-green-500 flex items-center justify-center text-white font-bold">70+</div>
                    <div>
                      <div className="font-semibold">Sangat Optimal</div>
                      <div className="text-sm text-gray-600">Produksi maksimal</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <div className="w-12 h-12 rounded-lg bg-yellow-500 flex items-center justify-center text-white font-bold">50-70</div>
                    <div>
                      <div className="font-semibold">Moderat</div>
                      <div className="text-sm text-gray-600">Perhatikan cuaca</div>
                    </div>
                  </div>
                  <div className="flex gap-3">
                    <div className="w-12 h-12 rounded-lg bg-red-500 flex items-center justify-center text-white font-bold">&lt;50</div>
                    <div>
                      <div className="font-semibold">Kurang Optimal</div>
                      <div className="text-sm text-gray-600">Risiko tinggi</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-5">
              <h4 className="font-bold text-blue-900 mb-3">üéØ Rekomendasi:</h4>
              <ul className="space-y-2 text-sm text-blue-800">
                <li>‚Ä¢ <strong>Jun-Sep</strong>: Periode terbaik, radiasi solar puncak Agustus-September</li>
                <li>‚Ä¢ <strong>Nov-Feb</strong>: Hindari, presipitasi tinggi hambat kristalisasi</li>
                <li>‚Ä¢ <strong>Apr-Mei</strong>: Persiapan lahan sebelum puncak produksi</li>
                <li>‚Ä¢ <strong>Agu-Sep</strong>: Kristalisasi tercepat (7-10 hari)</li>
              </ul>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default BinuangeunMaritimeViz;
